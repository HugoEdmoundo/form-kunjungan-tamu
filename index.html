<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Form Kunjungan</title>
  
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background: url('background.webp') fixed;
      background-size: cover;
      padding: 20px;
      color: #333;
    }
    .container-custom {
      background: rgba(255, 255, 255, 0.85);
      border-radius: 15px;
      padding: 25px;
      max-width: 1200px;
      margin: 0 auto;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
    }
    .header-custom {
      border-bottom: 2px solid rgba(255, 105, 60, 0.3);
      padding-bottom: 15px;
      margin-bottom: 25px;
    }
    .header-title {
      color: #ff5e62;
    }
    .form-section, .table-section {
      background: rgba(255, 255, 255, 0.9);
      padding: 25px;
      border-radius: 12px;
      box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
    }
    .camera-container {
      width: 100%;
      height: 200px;
      margin: 15px 0;
      background: linear-gradient(to bottom, #ffecd2, #fcb69f);
      border-radius: 10px;
      overflow: hidden;
      position: relative;
    }
    video, .photo-preview {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
    .btn-custom-primary {
      background: #ff5e62;
      color: white;
    }
    .btn-custom-secondary {
      background: #ff9966;
      color: white;
    }
    .btn-custom-danger {
      background: #ff4757;
      color: white;
    }
    .table-custom th {
      background: #ff7e5f;
      color: white;
    }
    .table-custom td, .table-custom th {
      border-bottom: 1px solid #ffddd2;
    }
  </style>
</head>
<body>
  <div class="container container-custom">
    <div class="d-flex align-items-center header-custom">
      <img src="logo.png" alt="logo" class="me-4" style="width: 100px;">
      <div>
        <h1 class="header-title fs-4">Telkom Landmark Tower 2</h1>
        <p class="text-muted small mt-2">Jl. Jend. Gatot Subroto Kav. 52 Gatot Subroto, Jakarta Selatan</p>
      </div>
    </div>

    <div class="row g-4 mt-3">
      <div class="col-lg-6">
        <form class="form-section" id="visitForm">
          <div class="mb-3">
            <label for="name" class="form-label fw-bold text-danger">Nama</label>
            <input type="text" class="form-control border-0 border-bottom border-warning bg-light bg-opacity-75 rounded-0 rounded-top" id="name" placeholder="Nama lengkap" required>
          </div>
          
          <div class="mb-3">
            <label for="purpose" class="form-label fw-bold text-danger">Tujuan</label>
            <input type="text" class="form-control border-0 border-bottom border-warning bg-light bg-opacity-75 rounded-0 rounded-top" id="purpose" placeholder="Tujuan kunjungan" required>
          </div>
          
          <div class="mb-3">
            <label for="identity" class="form-label fw-bold text-danger">Identitas</label>
            <input type="text" class="form-control border-0 border-bottom border-warning bg-light bg-opacity-75 rounded-0 rounded-top" id="identity" placeholder="Visitor/WaliMurid" required>
          </div>
          
          <div class="mb-3">
            <label class="form-label fw-bold text-danger">Ambil Foto</label>
            <div class="camera-container">
              <video id="liveCamera" autoplay playsinline class="d-none"></video>
              <div id="photoPreview" class="h-100 d-flex justify-content-center align-items-center text-muted">Pratinjau foto akan muncul disini</div>
            </div>
          </div>
          
          <div class="d-flex gap-3 my-3">
            <button type="button" class="btn btn-custom-primary flex-grow-1" id="startCamera">Aktifkan Kamera</button>
            <button type="button" class="btn btn-custom-secondary flex-grow-1" id="takePhoto" disabled>Ambil Foto</button>
          </div>
          
          <input type="file" id="photoUpload" accept="image/*" class="d-none">
          
          <div class="d-flex gap-3 mt-4">
            <button type="submit" class="btn btn-custom-primary flex-grow-1" id="submitBtn">Simpan Kunjungan</button>
            <button type="reset" class="btn btn-custom-danger flex-grow-1" id="resetBtn">Reset Form</button>
          </div>
        </form>
      </div>

      <div class="col-lg-6">
        <div class="table-section">
          <div class="d-flex justify-content-between align-items-center mb-3">
            <h2 class="header-title fs-5 mb-0">Daftar Kunjungan</h2>
            <button id="clearAllBtn" class="btn btn-custom-danger btn-sm">Hapus Semua Data</button>
          </div>
          
          <div class="table-responsive">
            <table class="table table-custom">
              <thead>
                <tr>
                  <th>Nama</th>
                  <th>Tujuan</th>
                  <th>Identitas</th>
                  <th>Tanggal</th>
                  <th>Foto</th>
                </tr>
              </thead>
              <tbody id="visitorList"></tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Bootstrap JS Bundle with Popper -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  
  <script>
    const video = document.getElementById('liveCamera');
      const preview = document.getElementById('photoPreview');
      const startBtn = document.getElementById('startCamera');
      const takeBtn = document.getElementById('takePhoto');
      const uploadBtn = document.getElementById('photoUpload');
      const form = document.getElementById('visitForm');
      let stream = null;

      // Fungsi untuk memuat data dari localStorage
      function loadVisitors() {
          const visitors = JSON.parse(localStorage.getItem('visitors')) || '[]';
          return Array.isArray(visitors) ? visitors : [];
      }

      // Fungsi untuk menyimpan data ke localStorage
      function saveVisitors(visitors) {
          localStorage.setItem('visitors', JSON.stringify(visitors));
      }

      // Fungsi untuk menampilkan data visitor
      function displayVisitors() {
          const visitors = loadVisitors();
          const visitorList = document.getElementById('visitorList');
          visitorList.innerHTML = '';
          
          visitors.forEach(visitor => {
              const photo = visitor.photo !== '-' ? `<img src="${visitor.photo}" width="60">` : '-';
              visitorList.innerHTML += `
                  <tr>
                      <td>${visitor.name}</td>
                      <td>${visitor.purpose}</td>
                      <td>${visitor.identity}</td>
                      <td>${visitor.date}</td>
                      <td>${photo}</td>
                  </tr>`;
          });
      }

      // Memuat data saat halaman dimuat
      document.addEventListener('DOMContentLoaded', displayVisitors);

      startBtn.addEventListener('click', async () => {
          try {
              stream = await navigator.mediaDevices.getUserMedia({ video: { width: 500, height: 300 } });
              video.srcObject = stream;
              video.style.display = 'block';
              preview.style.display = 'none';
              takeBtn.disabled = false;
              startBtn.disabled = true;
          } catch (err) {
              alert("Izinkan akses kamera untuk mengambil foto");
          }
      });

      takeBtn.addEventListener('click', () => {
          const canvas = document.createElement('canvas');
          canvas.width = video.videoWidth;
          canvas.height = video.videoHeight;
          canvas.getContext('2d').drawImage(video, 0, 0);
          preview.innerHTML = `<img src="${canvas.toDataURL('image/png')}" style="width:100%;height:100%;object-fit:cover;">`;
          stream.getTracks().forEach(track => track.stop());
          startBtn.disabled = false;
          takeBtn.disabled = true;
      });

      uploadBtn.addEventListener('change', (e) => {
          const file = e.target.files[0];
          if (file) {
              const reader = new FileReader();
              reader.onload = (event) => {
                  preview.innerHTML = `<img src="${event.target.result}" style="width:100%;height:100%;object-fit:cover;">`;
              };
              reader.readAsDataURL(file);
          }
      });

      form.addEventListener('submit', (e) => {
          e.preventDefault();
          const name = document.getElementById('name').value;
          const purpose = document.getElementById('purpose').value;
          const identity = document.getElementById('identity').value;
          
          const date = new Date().toLocaleString('id-ID');
          const photo = preview.querySelector('img')?.src || '-';
          
          // Membuat objek visitor baru
          const newVisitor = { name, purpose, identity, date, photo };
          
          // Mengambil data yang ada dan menambahkan yang baru
          const visitors = loadVisitors();
          visitors.unshift(newVisitor);
          saveVisitors(visitors);
          
          // Memperbarui tampilan
          displayVisitors();
          
          // Reset form
          form.reset();
          preview.innerHTML = 'Pratinjau foto akan muncul disini';
          if (stream) {
              stream.getTracks().forEach(track => track.stop());
          }
          startBtn.disabled = false;
          takeBtn.disabled = true;
      });

      document.getElementById('clearAllBtn').addEventListener('click', () => {
          if (confirm('Yakin hapus semua data?')) {
              localStorage.removeItem('visitors');
              displayVisitors();
          }
      });
  </script>
</body>
</html>
